# API Casting Agency Capstone Udacity

This API is an option of the capstone project defined in the Full Stack Web Developer Nanodegree Program. The Casting Agency models a company that is responsible for creating movies and managing and assigning actors to those movies. The motivation is to develop a system to simplify and streamline the process work of the Executive Producer within the company.

## Getting Started

### Pre-requisites and Local Development 
Developers using this project should already have Python3 and pip installed on their local machines.

#### Backend

This version of the API is only Backend; thus, the main folder concentrates all the required files.

From the main folder run `pip install requirements.txt`. All required packages are included in the requirements file.

The API relies on PostgreSQL database to store the data related to the Casting Agency API. To create the database run the following commands in a terminal:
```
psql
create database casting_agengy;
```

These commands will create the PostgreSQL database with the default configured name. Moreover, default postgress username and password are pre-configured. If you like to set a different name to the database or have a different username and password for PostgreSQL, please make sure to change this values in the `models.py`, `test_app.py`, and `setup.sh` files.

To run the application run the following commands: 
```
export FLASK_APP=app
export FLASK_ENV=development
flask run
```

These commands put the application in development and directs our API to use the `app.py` file in our main folder. Working in development mode shows an interactive debugger in the console and restarts the server whenever changes are made. If running locally on Windows, look for the commands in the [Flask documentation](http://flask.pocoo.org/docs/1.0/tutorial/factory/).

The `app.py` includes two helpfull functions: `db_drop_and_create_all` and `prepopulate_db`. The first function helps to clean all registers in the database when deploying the API. It is unused by default. The second function helps to insert demo data into the database when there is no registers in it when deploying the API . This function is used as default.

The API runs on `http://127.0.0.1:5000/` by default. To check that everything is working fine, in a browser introduce this URL and the message `Welcome to the Casting Agency "Films Udacity" API` will be displayed.

#### Authentication

This version of the API incorporates authentication via JWT Tokens generated by Auth0 (https://auth0.auth0.com/). In Auth0 the following Roles and Permissions were defined:
```
1) Casting Assistant
   - get:movies
   - get:actors

2) Casting Director
   - get:movies
   - get:actors
   - delete:actors
   - patch:actors
   - patch:movies
   - post:actors

3) Executive Producer
   - get:movies
   - get:actors
   - post:movies
   - post:actors
   - patch:movies
   - patch:actors
   - delete:movies
   - Delete:actors
```

Authorized JWT Tokens, with an expiration of 48 hours, for each role are:
```
1) Casting Assistant


2) Casting Director


3) Executive Producer
```

#### Frontend

This version of the API does not have a Frontend.

### Tests
This version of the application requires authentication via JWT Tokens (Auth0) for each previously mentioned user roles. JWT Tokens for each role can be modified in the `test_app.py` in the section identified as `Tokens`. Authorized JWT tokens were configured in `test_app.py`.

In order to run tests, first make sure that the API is runing wiht the `db_drop_and_create_all` function commented in the `app.py`. Then, in a terminal, navigate to the main folder and run the following commands: 

```
python3 test_app.py
```

All tests are kept in that file and should be maintained as updates are made to app functionality.

## API Reference

### Getting started

- Base URL: This API is hosted in Heroku at --put here the URL--. The backend app is hosted at the default, http://127.0.0.1:5000/

- Authentication: This version of the application requires authentication via JWT Tokens (Auth0). 

### Error Handling

Erros are returned as JSON objects in the following format

```javascript
{
   "success": False, 
   "error": 422,
   "message": "unprocessable"
 }
```

Currently the API will return four error types when requests fail:

- 401: Unauthorized
- 404: Resource not Found
- 405: Method not allowed
- 422: Not Processable

### Endpoints

The API uses JWT Tokens as an authentication method in all the following endpoints. Please use the previously provided Authorized JWT Tokens for each endpoint and role.

For test purposes, a JSON file Postman Collection named `Udacity-casting-agency` is provided with Authorized JWT Tokens.

#### GET/movies

- General:
   - Returns a list of movie objects and success value.
- Authorized roles:
   - Casting Assistant
   - Casting Director
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/movies ```

```javascript
{
    "movie": [
        {
            "cast": [
                "Felicity Jones"
            ],
            "id": 1,
            "release_date": "13 December 2016",
            "title": "Rogue One A Star Wars Story"
        },
        {
            "cast": [
                "Pedro Infante"
            ],
            "id": 2,
            "release_date": "13 September 1951",
            "title": "Full Speed Ahead"
        },
        {
            "cast": [
                "James Dean"
            ],
            "id": 3,
            "release_date": "20 January 1956",
            "title": "Rebel Without a Cause"
        },
        {
            "cast": [],
            "id": 4,
            "release_date": "20 January 2021",
            "title": "The Human Contract"
        }
    ],
    "success": true
}
```

#### GET/actors

- General:
    - Returns a list of actors objects and success value.
- Authorized roles:
   - Casting Assistant
   - Casting Director
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/actors ```

```javascript
{
    "actor": [
        {
            "age": 24,
            "filmography": [
                "Rebel Without a Cause"
            ],
            "gender": "male",
            "id": 1,
            "name": "James Dean"
        },
        {
            "age": 36,
            "filmography": [
                "Rogue One A Star Wars Story"
            ],
            "gender": "female",
            "id": 2,
            "name": "Felicity Jones"
        },
        {
            "age": 38,
            "filmography": [
                "Full Speed Ahead"
            ],
            "gender": "male",
            "id": 3,
            "name": "Pedro Infante"
        },
        {
            "age": 44,
            "filmography": [],
            "gender": "female",
            "id": 4,
            "name": "Paz Vega"
        }
    ],
    "success": true
}
```

#### POST/movies

- General:
    - Creates a new movie using the submitted title and release date. Returns the id, title, and release date of the created movie, as well as the success message.
- Authorized roles:
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/movies -X POST -H "Content-Type: application/json" -d '{"title":"Batman Lego 7","release_date":"14 July 2021"}' ```

```javascript
{
    "movie": {
        "id": 5,
        "release_date": "14 July 2021",
        "title": "Batman Lego 7"
    },
    "success": true
}
```

#### POST/actors

- General:
    - Creates a new actor using the submitted name, age, and gender. Returns the id, name, age, and gender of the created actor, as well as the success message.
- Authorized roles:
   - Casting Director
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/actors -X POST -H "Content-Type: application/json" -d '{"name":"Morgan Freeman","age":83,"gender":"Male"}' ```

```javascript
{
    "actor": {
        "age": 83,
        "gender": "Male",
        "id": 5,
        "name": "Morgan Freeman"
    },
    "success": true
}
```

#### PATCH/movies/{movie_id}

- General:
    - Updates the title and release date of the movie given ID if it exists. Returns the id, title, and release date of the updated movie, as well as the success message.
- Authorized roles:
   - Casting Director
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/movies/5 -X PATCH -H "Content-Type: application/json" -d '{"title":"Batman Lego 7 Unleashed","release_date":"14 September 2021"}' ```

```javascript
{
    "movie": {
        "id": 5,
        "release_date": "14 September 2021",
        "title": "Batman Lego 7 Unleashed"
    },
    "success": true
}
```

#### PATCH/actors/{actor_id}

- General:
    - Updates the name, age, and gender of the actor given ID if it exists. Returns the id, name, age, and gender of the updated actor, as well as the success message.
- Authorized roles:
   - Casting Director
   - Executive Producer
- Sample: ``` curl http://127.0.0.1:5000/actors/5 -X PATCH -H "Content-Type: application/json" -d '{"name":"Morgan F.","age":84,"gender":"Male"}' ```

```javascript
{
    "actor": {
        "age": 84,
        "gender": "Male",
        "id": 5,
        "name": "Morgan F."
    },
    "success": true
}
```


#### DELETE/movies/{movie_id}

- General:
    - Deletes a movie of the given ID if it exists. Returns the id, title, and release date of the deleted movie, as well as the success message.
- Authorized roles:
   - Executive Producer
- Sample: ``` curl -X DELETE http://127.0.0.1:5000/movies/5  ```

```javascript
{
    "movie": {
        "id": 5,
        "release_date": "14 September 2021",
        "title": "Batman Lego 7 Unleashed"
    },
    "success": true
}
```

#### DELETE/actors/{actor_id}

- General:
    - Deletes an actor of the given ID if it exists. Returns the id, name, age, and gender of the deleted actor, as well as the success message.
- Authorized roles:
   - Casting Director
   - Executive Producer
- Sample: ``` curl -X DELETE http://127.0.0.1:5000/actors/5  ```

```javascript
{
    "actor": {
        "age": 84,
        "gender": "Male",
        "id": 5,
        "name": "Morgan F."
    },
    "success": true
}
```

## Authors

The base code is part of the Udacity Full Stack Web Developer Course.

Modifications to backend and test files were done by Ari Yair Barrera Animas.
